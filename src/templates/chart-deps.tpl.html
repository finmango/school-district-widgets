<!-- Google Charts -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<!-- CSV Parsing -->
<script type="text/javascript" src="{{root}}/third_party/papaparse/papaparse.min.js"></script>

<!-- Custom dependencies for data handling -->
<script type="text/javascript" src="{{root}}/static/data-loader.min.js"></script>

<!-- Configuration loading -->
<script type="text/javascript">

    // Global object used to cache objects and data
    CACHE = window.CACHE || { 'CSV': {}, 'gcharts': {} };

    // Define constants and default options
    DEFAULT_OPTIONS = window.DEFAULT_OPTIONS || {
        'tcm-metadata-url': 'https://storage.googleapis.com/school-districts/school-districts-metadata.csv',
        'cod-data-url': 'https://storage.googleapis.com/covid19-open-data/v3',
        'tcm-data-url': 'https://storage.googleapis.com/school-districts/cases/latest-school-cases.csv',
    }

    // Read options from session storage
    CURRENT_OPTIONS = window.CURRENT_OPTIONS || Object.keys(DEFAULT_OPTIONS).reduce((acc, key) =>
        Object.assign(acc, { [key]: sessionStorage.getItem(key) || DEFAULT_OPTIONS[key] }), {});

    // Create a default configuration for Google Charts
    GOOGLE_CHARTS_CONFIG = window.GOOGLE_CHARTS_CONFIG || {
        theme: 'material',
        colors: ['{{theme-primary}}'],
        legend: {
            position: CURRENT_OPTIONS.chart_legend_position || 'none'
        },
        chartArea: {
            width: '100%',
            height: '100%',
            left: parseInt(CURRENT_OPTIONS.chart_padding_left || 64),
            bottom: parseInt(CURRENT_OPTIONS.chart_padding_bottom || 48),
            top: parseInt(CURRENT_OPTIONS.chart_padding_top || 24),
        },
        titlePosition: 'in',
        axisTitlesPosition: 'in',
        hAxis: {
            textPosition: 'bottom'
        },
        vAxis: {
            textPosition: 'in',
            viewWindow: { min: 0 }
        },
        height: parseInt(CURRENT_OPTIONS.chart_height || 300),
    }
</script>